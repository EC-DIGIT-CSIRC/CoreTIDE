title: MDR Schema validator
description: A Managed Detection Rule is ...

$schema: http://json-schema.org/draft-07/schema#
additionalProperties: false

tide.placeholders:
  SCHEMA_VERSION: mdr::2.1

required:
  - name
  - response
  - description
  - configurations

tide.template.force-required:
  - metadata

anyOf:
  - required:
    - metadata
  - required:
    - meta

properties:

  name:
    title: Display name
    type: string
    description: Verbose, human readable name for the detection rule
    example: New Abnormal Credentials added to Azure AD

  references:
    tide.meta.definition: true

  metadata:
    tide.template.spacer: true
    tide.meta.definition: true

  meta:
    tide.template.hide: true
    tide.meta.deprecation: Use metadata keyword instead
    tide.meta.definition: metadata

  description:
    title: Detection description
    tide.template.spacer: true
    description: Explanation of what the detection rule is detecting, in order to give context to alerts receivers.
    type: string
    tide.template.multiline : True

  detection_model: 
    title: CoreTIDE Cyber Detection Model
    tide.vocab: cdm
    description: CDM that this detection rule is implementing.
    example: CDM0016

  response:
    title: Incident Response Details
    type: object
    description: Information regarding incident response procedures
    required:
      - alert_severity
    properties:

      alert_severity: 
        title: Alert Severity
        type: string
        description: Describes the level of attention required to handle the alert generated by the MDR.
        tide.vocab: true #TODO - migrate to config once config fetch is implemented

      playbook: 
        title: Playbook link
        type: string
        format: uri
        description: Link to the playbook on Confluence
        example: https://internal-knowledge-base/playbook/account_brute_force
      
      responders:
        title: Alert Handling Team
        type: string
        tide.vocab: true #TODO - migrate to config once config fetch is implemented
        description: Team responsible for handling related incoming alerts

      procedures:
        title: Response Procedure
        type: object
        tide.template.spacer: False
        description: | 
          Supportive information for the responders to alerts/events/incidents
          triggered by this detection rule  
        required:
          - analysis
        properties:

          analysis:
            title: Alert Analysis
            type: string
            description: Guidelines to handle the alert 
            tide.template.multiline: True

          searches:
            title: Supporting searches
            type: array
            description: Data Queries that support the incident investigation process
            items:
              type: object
              required:
                - purpose
                - system
                - query
              properties:

                purpose:
                  title: Short explanation of the search
                  type: string
                  description: Describes how the search supports the investigative process

                system:
                  title: Target system for the search
                  type: string
                  enum: #TODO - source this from config files once config fetch is implemented
                    - splunk
                    - sentinel
                    - defender_for_endpoint
                    - carbon_black_cloud 
                    - sysdig
                
                query:
                  title: Supporting Search Query
                  type: string
                  tide.template.multiline: True



  configurations:
    title: Detection System Technical Setup
    type: object
    description: Per system setup of the detection configurations
    recomposition : systems # Calls the automation to insert subschemas
